class PostComments{constructor(e){this.postId=e,this.postContainer=$("#post-"+e),this.newCommentForm=$(`#post-${e}-comments-form`),this.createComment(e);let t=this;$(" .delete-comment-button",this.postContainer).each((function(){t.deleteComment($(this))}))}createComment(e){let t=this;this.newCommentForm.submit((function(n){n.preventDefault();$.ajax({type:"post",url:"/comments/create",data:$(this).serialize(),beforeSend:function(){let e=$(" input[type=submit]",t.newCommentForm);e.attr("disabled","disabled"),e.css("opacity","0.7")},success:function(n){$(" textarea",t.newCommentForm).val(""),$(" textarea",t.newCommentForm).css("height","auto");let o=t.newCommentDom(n.data.comment,n.data.post_user_id);$("#post-comments-list-"+e).prepend(o);let s=parseInt($("#comments-count-"+e).html().trim());$("#comments-count-"+e).text(s+1),t.deleteComment($(" .delete-comment-button",o)),new ToggleLike($(" .toggle-like-button",o)),showPostCommentMoreOption($("#post-comment-more-icon-"+n.data.comment._id)),new Noty({theme:"relax",text:"Comment published!",type:"success",layout:"topRight",timeout:1500}).show();let m=$(" input[type=submit]",t.newCommentForm);m.removeAttr("disabled"),m.css("opacity","1")},error:function(e){console.log(e.responseText)}})}))}newCommentDom(e,t){let n=$(`\n        <div id="comment-${e._id}" class="comment-list-container">\n            <div class="comment-user-info">\n                <div class="user-comment-details">\n                    <a href="/users/profile/${e.user.id}">\n                        <div class="comment-user-name-pic">\n                            <img src="/images/Users-avatar.png" alt="img">\n                                <span>You</span>\n                        </div>\n                    </a>\n                    <br>\n                    <small>${new Date(e.createdAt).toString().substring(4,16)} at ${new Date(e.createdAt).toString().substring(16,21)}</small>\n                </div>\n                <span class="post-comment-more-icon" id="post-comment-more-icon-${e._id}">\n                    <i class="fas fa-ellipsis-h"></i>\n                </span>\n                <span class="post-comment-close-icon" id="post-comment-close-icon-${e._id}">\n                    <i class="far fa-times-circle"></i>\n                </span>\n\n                <ul class="post-comment-more-options animate__animated animate__flipInX" id="post-comment-more-options-${e._id}">\n                    \x3c!-- Delete a comment --\x3e\n                    <a class="delete-comment-button" href="/comments/destroy/?id=${e._id}&post_user_id=${t}">\n                        <li>Delete Comment</li>\n                    </a>\n\n                </ul>\n            </div>\n\n            <div class="comment-content">\n                ${e.content}\n            </div>\n\n            <div class="comment-user-controls">\n                \x3c!-- Display the likes of this comment, if the user is logged in, then show the link to toggle likes, else, just show the count --\x3e\n                <div class="comment-likes-container">\n                    <a class="toggle-like-button" data-likes="${e.likes.length}" href="/likes/toggle/?id=${e._id}&type=Comment">\n                        <div class="likes-count">\n                            ${e.likes.length}\n                            <i class="far fa-thumbs-up"></i> Likes \n                        </div>\n                    </a>\n                </div>\n            </div>\n\n        </div>\n        `);return $(" .comment-user-name-pic img",n).attr("src",$("#nav-avatar").attr("src")),n}deleteComment(e){deleteCommentAjax(e)}}function deleteCommentAjax(e){$(e).click((function(t){t.preventDefault(),$.ajax({type:"get",url:$(e).prop("href"),beforeSend:function(){e.css({opacity:"0.7","pointer-events":"none"})},success:function(e){console.log("Successfully deleted"),$("#comment-"+e.data.comment_id).remove();let t=parseInt($("#comments-count-"+e.data.post_id).html().trim());$("#comments-count-"+e.data.post_id).text(t-1),new Noty({theme:"relax",text:"Comment Deleted",type:"success",layout:"topRight",timeout:1500}).show()},error:function(e){console.log(e.responseText)}})}))}